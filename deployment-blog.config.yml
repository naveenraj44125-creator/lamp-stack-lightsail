# Modern Blog Application Deployment Configuration

aws:
  region: us-east-1

lightsail:
  instance_name: modern-blog-app-v1
  static_ip: ""
  
  # Instance size configuration
  bundle_id: "small_3_0"  # 2GB RAM, 2 vCPU, 60GB SSD
  
  # Operating system blueprint
  blueprint_id: "ubuntu_22_04"  # Ubuntu 22.04 LTS

application:
  name: modern-blog
  version: "1.0.0"
  type: nodejs
  
  package_files:
    - "example-blog-app/"
  
  package_fallback: true
  
  environment_variables:
    NODE_ENV: production
    PORT: "3000"
    DATA_DIR: "/opt/blog-app/data"

dependencies:
  nodejs:
    enabled: true
    config:
      version: "18"
      install_pm2: true
      pm2_startup: true
  
  nginx:
    enabled: true
    config:
      server_name: "_"
      proxy_pass: "http://localhost:3000"
      client_max_body_size: "10M"
  
  git:
    enabled: true
    config:
      install_lfs: false
  
  firewall:
    enabled: true
    config:
      allowed_ports:
        - "22"    # SSH
        - "80"    # HTTP
        - "443"   # HTTPS
      deny_all_other: true

deployment:
  use_docker: false
  web_root: "/opt/blog-app"
  backup_existing: true
  restart_services: true
  
  timeouts:
    ssh_connection: 120
    command_execution: 600
    health_check: 180
  
  retries:
    max_attempts: 3
    ssh_connection: 5
  
  steps:
    pre_deployment:
      common:
        enabled: true
        update_packages: true
        create_directories: true
        backup_enabled: true
      dependencies:
        enabled: true
        install_system_deps: true
        configure_services: true
    
    post_deployment:
      common:
        enabled: true
        verify_extraction: true
        create_env_file: true
        cleanup_temp_files: true
      dependencies:
        enabled: true
        configure_application: true
        set_permissions: true
        restart_services: true
    
    verification:
      enabled: true
      health_check: true
      external_connectivity: true
      endpoints_to_test:
        - "/"
        - "/api/health"
        - "/api/posts"

github_actions:
  triggers:
    push_branches:
      - main
      - master
    pull_request_branches:
      - main
      - master
    workflow_dispatch: true
  
  jobs:
    test:
      enabled: true
      nodejs_test: true
    
    deployment:
      deploy_on_push: true
      deploy_on_pr: false
      artifact_retention_days: 1
      create_summary: true

monitoring:
  health_check:
    endpoint: "/api/health"
    expected_content: "healthy"
    max_attempts: 15
    wait_between_attempts: 20
    initial_wait: 30
  
  nodejs_health:
    check_process: true
    pm2_status: true

security:
  file_permissions:
    web_files: "644"
    directories: "755"
    config_files: "600"

backup:
  enabled: true
  retention_days: 7
  backup_location: "/var/backups/blog-deployments"
  include_data: true

# DEPLOYMENT INSTRUCTIONS:
# 1. Ensure AWS credentials are configured in GitHub Secrets
# 2. Push to main branch to trigger automatic deployment
# 3. Access your blog at http://YOUR_INSTANCE_IP/
# 4. The blog will automatically create sample posts on first run